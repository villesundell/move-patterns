<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Move Patterns: Design Patterns for Resource Based Programming</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Book on software design patterns for Move smart contract programming language.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Design Patterns</li><li class="chapter-item expanded "><a href="nestable_resources.html"><strong aria-hidden="true">1.</strong> Nestable Resources</a></li><li class="chapter-item expanded "><a href="multiple_configurations.html"><strong aria-hidden="true">2.</strong> Multiple Configurations</a></li><li class="chapter-item expanded "><a href="accountless_design.html"><strong aria-hidden="true">3.</strong> Accountless Design</a></li><li class="chapter-item expanded "><a href="script_based_design.html"><strong aria-hidden="true">4.</strong> Script Based Design</a></li><li class="chapter-item expanded "><a href="hot_potato.html"><strong aria-hidden="true">5.</strong> Hot Potato</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Move Patterns: Design Patterns for Resource Based Programming</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/villesundell/move-patterns" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>While there have been other resource based programming languages in the past (such as <a href="http://www.cs.cmu.edu/%7Ealdrich/plaid/">Plaid</a>), resource based programming is still a niche, largely because of lack of real world use cases. The <a href="https://github.com/move-language/move/">Move smart contract programming language</a> and blockchains changes the game, providing an ecosystem and intuitive environment for resource oriented designs.</p>
<p>Move language (and its MoveVM virtual machine) was designed originally by Facebook to power their <a href="https://en.wikipedia.org/wiki/Diem_(digital_currency)">Diem</a> blockchain project. Fortunately Move was adopted by multiple blockchain projects as their smart contract execution environment before Diem was discontinued, so Move continued living separately as an independent project.</p>
<p>Today Move, and its virtual machine are powering <a href="https://github.com/MystenLabs/awesome-move#move-powered-blockchains">multiple blockchains</a>, most of which are still in early development phase.</p>
<p>Move is currently the most mature resource based ecosystem (especially for blockchains), so code examples are written in Move. However it is likely that some of these concepts can be implemented also in some other resource based language and ecosystem.</p>
<h2 id="what-this-book-is"><a class="header" href="#what-this-book-is">What this book is</a></h2>
<p>This book is for discussing software design paradigms and best practices for resource based languages, especially Move.</p>
<h2 id="what-this-book-is-not"><a class="header" href="#what-this-book-is-not">What this book is not</a></h2>
<p>This book is not a guide to Move or any other resource based language. For books on Move itself, see <a href="https://github.com/MystenLabs/awesome-move#books">this list</a>. Also see <a href="https://github.com/MystenLabs/awesome-move">awesome-move</a> for a curated list of code and content from the Move programming language community.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p><a href="https://creativecommons.org/licenses/by/4.0/" title="Creative Commons Attribution 4.0 International License"><img src="https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by.svg" alt="CC BY 4.0 license button" title="CC BY 4.0 license button" /></a></p>
<p>Move Patterns: Design Patterns for Resource Based Programming Â© 2022 by <a href="https://github.com/villesundell">Ville Sundell</a> is licensed under CC BY 4.0. To view a copy of this license, visit <a href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nestable-resources"><a class="header" href="#nestable-resources">Nestable Resources</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Nestable Resources</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/villesundell">Ville Sundell</a></td></tr>
<tr><td><strong>Example</strong></td><td><a href="https://github.com/taoheorg/taohe">TaoHe project</a></td></tr>
<tr><td><strong>Depends on</strong></td><td>None</td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p><strong>Nestable Resources</strong> provides a resource native approach to code reuse by building a nested structure of resources where each resource can be detached for use if the conditions are satisfied. For example, tokens can be placed to a time locked resource, which in turn can be placed to a resource which can be used only by a certain user, effectively creating a time locked NFT. For cleaner design it is recommended that the interfaces for wrapping and unwrapping match across modules.</p>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multiple-configurations"><a class="header" href="#multiple-configurations">Multiple Configurations</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Multiple Configurations</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/villesundell">Ville Sundell</a></td></tr>
<tr><td><strong>Example</strong></td><td><a href="https://web.archive.org/web/20211130211815/https://community.diem.com/t/multiple-configurations-approach-a-possible-design-pattern/3485">Diem Forum Post</a></td></tr>
<tr><td><strong>Depends on</strong></td><td>None</td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary-1"><a class="header" href="#summary-1">Summary</a></h2>
<p>In the <strong>Multiple Configurations</strong> approach singletons (especially for configuration data) are provided to the module as arguments instead of storing them to any specific location. </p>
<p>By incorporating this design into your modules, you would automatically add a layer of configurability by giving users or admins (if any) a way to create configurations which others could use. This would be similar to Uniswap which lets anyone create markets others could participate in.</p>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<p>Let's say you have an auction smart contract X. and an admin has created a configuration to account A. Then B could issue a transaction script to bid on C's resource like this:</p>
<pre><code>X.place_bid(A, C, 1234);
</code></pre>
<p>By accepting parameters (such as C and the amount 1234), a transaction script could trivially hide the selection of the configuration. This depends, how flexible the final script implementation is in terms of arguments to main(), but the transaction script could look like this (quick mock-up):</p>
<pre><code>script {
    use 0xFF::X;
    
    const CONF: address = 0xCOFFEE;

    fun main(a: address, amount: XUS) {
        X.place_bid(CONF, a, amount);
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="accountless-design"><a class="header" href="#accountless-design">Accountless Design</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Accountless Design</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/villesundell">Ville Sundell</a></td></tr>
<tr><td><strong>Example</strong></td><td><a href="https://web.archive.org/web/20220202065315/https://community.diem.com/t/outbox-an-alternative-way-to-store-resources/3737">Diem Forum Post</a></td></tr>
<tr><td><strong>Depends on</strong></td><td>None</td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary-2"><a class="header" href="#summary-2">Summary</a></h2>
<p>Move module following the <strong>Accountless Design</strong> pattern doesn't handle storage (<code>move_to()</code> / <code>move_from()</code>) directly, instead the storage must be handled outside the module in transaction scripts. This makes the module code footprint smaller, design simpler, implementation more portable and provides a way to implement storage agnostic smart contract design on Move powered platforms.</p>
<h2 id="examples-2"><a class="header" href="#examples-2">Examples</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="script-based-design"><a class="header" href="#script-based-design">Script Based Design</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Script Based Design</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/villesundell">Ville Sundell</a></td></tr>
<tr><td><strong>Example</strong></td><td>This file</td></tr>
<tr><td><strong>Depends on</strong></td><td><a href="./accountless_design.html">Accountless Design</a></td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary-3"><a class="header" href="#summary-3">Summary</a></h2>
<p><strong>Script Based Design</strong> combines <a href="./accountless_design.html">Accountless Design</a> with <em>Move Transaction Scripts</em> enabling a design where most of the business logic resides in transaction scripts, while keeping the most critical parts in modules. This way the transaction scripts can be developed and improved faster than a regular module would, while providing the same kind of guarantees as regular modules by keeping the most critical state transitions in modules.</p>
<h2 id="examples-3"><a class="header" href="#examples-3">Examples</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hot-potato"><a class="header" href="#hot-potato">Hot Potato</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Hot Potato</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/tnowacki">Todd Nowacki</a> / <a href="https://github.com/MystenLabs/">Mysten Labs</a></td></tr>
<tr><td><strong>Example</strong></td><td><a href="https://github.com/MystenLabs/sui/blob/a6156aeaf332b9f257cf04063a9a751a7a431360/sui_programmability/examples/defi/sources/flash_lender.move">FlashLender.move</a></td></tr>
<tr><td><strong>Depends on</strong></td><td>None</td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary-4"><a class="header" href="#summary-4">Summary</a></h2>
<p>A <strong>Hot Potato</strong> is a struct without <code>key</code>, <code>store</code> and <code>drop</code> <a href="https://move-language.github.io/move/abilities.html">abilities</a> forcing the struct to be used within the transaction it was created in. This is desired in applications like <a href="https://github.com/MystenLabs/sui/blob/a6156aeaf332b9f257cf04063a9a751a7a431360/sui_programmability/examples/defi/sources/flash_lender.move">flash loans</a> where the loans must be initiated and repaid during the same transaction.</p>
<h2 id="examples-4"><a class="header" href="#examples-4">Examples</a></h2>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
