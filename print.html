<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Move Patterns: Design Patterns for Resource Based Programming</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Book on software design patterns for Move smart contract programming language.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Design Patterns</li><li class="chapter-item expanded "><a href="capability.html"><strong aria-hidden="true">1.</strong> Capability</a></li><li class="chapter-item expanded "><a href="multiple_configurations.html"><strong aria-hidden="true">2.</strong> Multiple Configurations</a></li><li class="chapter-item expanded "><a href="nestable_resources.html"><strong aria-hidden="true">3.</strong> Nestable Resources</a></li><li class="chapter-item expanded "><a href="witness.html"><strong aria-hidden="true">4.</strong> Witness</a></li><li class="chapter-item expanded "><a href="accountless_design.html"><strong aria-hidden="true">5.</strong> Accountless Design</a></li><li class="chapter-item expanded "><a href="hot_potato.html"><strong aria-hidden="true">6.</strong> Hot Potato</a></li><li class="chapter-item expanded "><a href="script_based_design.html"><strong aria-hidden="true">7.</strong> Script Based Design</a></li><li class="chapter-item expanded "><a href="transferable_witness.html"><strong aria-hidden="true">8.</strong> Transferable Witness</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Move Patterns: Design Patterns for Resource Based Programming</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/villesundell/move-patterns" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>While there have been other resource based programming languages in the past (such as <a href="http://www.cs.cmu.edu/%7Ealdrich/plaid/">Plaid</a>), for a long time resource based programming has been a niche, lacking applications where resource based approach would excel. However, <a href="https://en.wikipedia.org/wiki/Smart_contract">smart contracts</a> and <a href="https://en.wikipedia.org/wiki/Blockchain">blockchains</a> introduced software development challenges that can be answered with resource based programming.</p>
<p>The <a href="https://github.com/move-language/move/">Move language</a> and its Move Virtual Machine were designed originally by Facebook to power their <a href="https://en.wikipedia.org/wiki/Diem_(digital_currency)">Diem</a> blockchain platform providing an intuitive environment and ecosystem for resource oriented applications. Fortunately Move was adopted by multiple blockchain projects as their smart contract execution environment before Diem was discontinued, so Move continues living separately as an independent project.</p>
<p>Today Move and its virtual machine are powering <a href="https://github.com/MystenLabs/awesome-move#move-powered-blockchains">multiple blockchains</a>, most of which are still in the early development phase.</p>
<p>Because Move is currently the most widely developed resource based programming language for blockchains, code examples are written in Move. However it is likely that some of these patterns can be implemented also in some other resource based language and ecosystem.</p>
<h2 id="what-this-book-is"><a class="header" href="#what-this-book-is">What this book is</a></h2>
<p>This book is for discussing software design paradigms and best practices for resource based languages, especially Move and its flavors.</p>
<h2 id="what-this-book-is-not"><a class="header" href="#what-this-book-is-not">What this book is not</a></h2>
<p>This book is not a guide to Move or any other resource based language. For books on Move itself, see <a href="https://github.com/MystenLabs/awesome-move#books">this list</a>. Also see <a href="https://github.com/MystenLabs/awesome-move">awesome-move</a> for a curated list of code and content from the Move programming language community.</p>
<h2 id="technical-disclaimer"><a class="header" href="#technical-disclaimer">Technical disclaimer</a></h2>
<p>This book is designed to be viewed digitally with hyperlink support (such as PDF or web format). For now the <a href="https://en.wikipedia.org/wiki/Software_design_pattern#Documentation">full software pattern format</a> is not followed, instead the patterns are simply defined by a short summary and examples.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p><a href="https://creativecommons.org/licenses/by/4.0/" title="Creative Commons Attribution 4.0 International License"><img src="https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by.svg" alt="CC BY 4.0 license button" title="CC BY 4.0 license button" /></a></p>
<p>Move Patterns: Design Patterns for Resource Based Programming © 2022 by <a href="https://github.com/villesundell">Ville Sundell</a> is licensed under CC BY 4.0. To view a copy of this license, visit <a href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="capability"><a class="header" href="#capability">Capability</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Capability</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/move-language/move/blob/5e034dde19a5320d7e2bdc9da25114e816b4454d/language/stdlib/modules/libra_coin.mvir#L8">Libra Project</a> / Unknown Author</td></tr>
<tr><td><strong>Example</strong></td><td><a href="https://examples.sui.io/patterns/capability.html">Sui Move by Example</a> / <a href="https://github.com/damirka">Damir Shamanaev</a></td></tr>
<tr><td><strong>Depends on</strong></td><td>None</td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>A <strong>Capability</strong> is a resource proving that the owner of the resource is permitted to execute a certain action. This is the oldest known Move design pattern dating back to the Libra project and its token smart contract, where capabilities were used to authorize minting of coins.</p>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<pre><code class="language-move">module examples::item {
    use sui::transfer;
    use sui::id::VersionedID;
    use sui::utf8::{Self, String};
    use sui::tx_context::{Self, TxContext};

    /// Type that marks Capability to create new `Item`s.
    struct AdminCap has key { id: VersionedID }

    /// Custom NFT-like type.
    struct Item has key, store { id: VersionedID, name: String }

    /// Module initializer is called once on module publish.
    /// Here we create only one instance of `AdminCap` and send it to the publisher.
    fun item(ctx: &amp;mut TxContext) {
        transfer::transfer(AdminCap {
            id: tx_context::new_id(ctx)
        }, tx_context::sender(ctx))
    }

    /// The entry function can not be called if `AdminCap` is not passed as
    /// the first argument. Hence only owner of the `AdminCap` can perform
    /// this action.
    public entry fun create_and_send(
        _: &amp;AdminCap, name: vector&lt;u8&gt;, to: address, ctx: &amp;mut TxContext
    ) {
        transfer::transfer(Item {
            id: tx_context::new_id(ctx),
            name: utf8::string_unsafe(name)
        }, to)
    }
}
</code></pre>
<p><em>Example for Sui Move is taken from the book <a href="https://examples.sui.io/patterns/capability.html">Sui Move by Example</a> by <a href="https://github.com/damirka">Damir Shamanaev</a>.</em></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multiple-configurations"><a class="header" href="#multiple-configurations">Multiple Configurations</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Multiple Configurations</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/villesundell">Ville Sundell</a></td></tr>
<tr><td><strong>Example</strong></td><td><a href="https://web.archive.org/web/20211130211815/https://community.diem.com/t/multiple-configurations-approach-a-possible-design-pattern/3485">Diem Forum Post</a></td></tr>
<tr><td><strong>Depends on</strong></td><td>None</td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary-1"><a class="header" href="#summary-1">Summary</a></h2>
<p>In the <strong>Multiple Configurations</strong> approach singletons (especially for configuration data) are provided to the module as arguments instead of storing them to any specific location. </p>
<p>By incorporating this design into your modules, you would automatically add a layer of configurability by giving users or admins (if any) a way to create configurations which others could use. This would be similar to Uniswap which lets anyone create markets others could participate in.</p>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<p>Let's say you have an auction smart contract X and an admin has created a configuration to account A. Then B could issue a transaction script to bid on C's resource like this:</p>
<pre><code class="language-move">X::place_bid(A, C, 1234);
</code></pre>
<p>By accepting parameters (such as C and the amount 1234), a transaction script could trivially hide the selection of the configuration. This depends, how flexible the final script implementation is in terms of arguments to <code>main()</code>, but the transaction script could look like this (quick mock-up):</p>
<pre><code class="language-move">script {
    use 0xFF::X;

    const CONF: address = 0xCOFFEE;

    fun main(a: address, amount: XUS) {
        X::place_bid(CONF, a, amount);
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nestable-resources"><a class="header" href="#nestable-resources">Nestable Resources</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Nestable Resources</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/villesundell">Ville Sundell</a></td></tr>
<tr><td><strong>Example</strong></td><td><a href="https://github.com/taoheorg/taohe">TaoHe project</a></td></tr>
<tr><td><strong>Depends on</strong></td><td>None</td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary-2"><a class="header" href="#summary-2">Summary</a></h2>
<p><strong>Nestable Resources</strong> pattern provides a resource native approach to code reuse by building a nested structure of resources where each resource can be detached for use if the conditions are satisfied. For example, tokens can be placed into a time locked resource, which in turn can be placed into a resource which can be used only by a certain user, effectively creating a timelocked non-fungible token. For cleaner design and easier integration it is recommended that the nestable resources share a common interface for wrapping and unwrapping.</p>
<h2 id="examples-2"><a class="header" href="#examples-2">Examples</a></h2>
<pre><code class="language-move">/// A nested resource (tao) for implementing a simple ownership model: owner can extract
/// the content.
module 0x1::Ownable {
    use Std::Signer;

    /// Simple ownership tao: the `owner` can extract `content`.
    struct Tao&lt;Content&gt; has key, store {
        owner: address,
        content: Content
    }

    /// Wrapping `content` into a tao the `owner` can only extract.
    public fun wrap&lt;Content&gt;(owner: address, content: Content): Tao&lt;Content&gt; {
        Tao&lt;Content&gt; { owner, content }
    }

    /// Immutable read-only reference to the owner address, and `content`.
    public fun read&lt;Content&gt;(tao: &amp;Tao&lt;Content&gt;): (&amp;address, &amp;Content) {
        let Tao&lt;Content&gt; { owner, content } = tao;

        (owner, content)
    }

    /// If `account ` is the `owner`, extract `content`.
    public fun unwrap&lt;Content&gt;(account: &amp;signer, tao: Tao&lt;Content&gt;): Content {
        let Tao&lt;Content&gt; { owner, content } = tao;

        assert!(owner == Signer::address_of(account), 123);

        content
    }
}
</code></pre>
<pre><code class="language-move">/// A folder tao to store an arbitrary number of taos.
module 0x1::Folder {
    /// A simple tao struct containing a vector of resources.
    struct Tao&lt;Content&gt; has key, store {
        content: vector&lt;Content&gt;
    }

    /// Create a new tao, with the static set of resources inside it.
    public fun wrap&lt;Content&gt;(content: vector&lt;Content&gt;): Tao&lt;Content&gt; {
        Tao&lt;Content&gt; { content }
    }

    /// Immutable read-only reference to the vector containing resources.
    public fun read&lt;Content&gt;(tao: &amp;Tao&lt;Content&gt;): &amp;vector&lt;Content&gt; {
        let Tao&lt;Content&gt; { content } = tao;

        content
    }

    /// Destroy the tao, and return the static set of resources inside it.
    public fun unwrap&lt;Content&gt;(tao: Tao&lt;Content&gt;): vector&lt;Content&gt; {
        let Tao&lt;Content&gt; { content } = tao;

        content
    }
</code></pre>
<p><em>A token can be placed inside <code>Ownable</code> and it can be placed inside <code>Folder</code>, or other way around, if so desired.</em></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="witness"><a class="header" href="#witness">Witness</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Witness</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/MystenLabs/sui/blob/c1ed7cc451119432d32d8eacf471f314e0ce5275/fastx_programmability/sources/Coin.move#L85">FastX</a> / <a href="https://github.com/sblackshear">Sam Blackshear</a></td></tr>
<tr><td><strong>Example</strong></td><td><a href="https://examples.sui.io/patterns/witness.html">Sui Move by Example</a> / <a href="https://github.com/damirka">Damir Shamanaev</a></td></tr>
<tr><td><strong>Depends on</strong></td><td>None</td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary-3"><a class="header" href="#summary-3">Summary</a></h2>
<p>A <strong>Witness</strong> is an ephemeral resource designed to prove only once that the a resource in question can be initiated only once after the witness has been created. The resource is dropped after use, ensuring that the same resource cannot be reused to initialize any other struct.</p>
<h2 id="examples-3"><a class="header" href="#examples-3">Examples</a></h2>
<pre><code class="language-move">/// Module that defines a generic type `Guardian&lt;T&gt;` which can only be
/// instantiated with a witness.
module examples::guardian {
    use sui::id::VersionedID;
    use sui::tx_context::{Self, TxContext};

    /// Phantom parameter T can only be initialized in the `create_guardian`
    /// function. But the types passed here must have `drop`.
    struct Guardian&lt;phantom T: drop&gt; has key, store {
        id: VersionedID
    }

    /// The first argument of this function is an actual instance of the
    /// type T with `drop` ability. It is dropped as soon as received.
    public fun create_guardian&lt;T: drop&gt;(
        _witness: T, ctx: &amp;mut TxContext
    ): Guardian&lt;T&gt; {
        Guardian { id: tx_context::new_id(ctx) }
    }
}

/// Custom module that makes use of the `guardian`.
module examples::peace {
    use sui::transfer;
    use sui::tx_context::{Self, TxContext};

    // Use the `guardian` as a dependency.
    use 0x0::guardian;

    /// This type is intended to be used only once.
    struct PEACE has drop {}

    /// Module initializer is the best way to ensure that the
    /// code is called only once. With `Witness` pattern it is
    /// often the best practice.
    fun init(ctx: &amp;mut TxContext) {
        transfer::transfer(
            guardian::create_guardian(PEACE {}, ctx),
            tx_context::sender(ctx)
        )
    }
}
</code></pre>
<p><em>Example for Sui Move is taken from the book <a href="https://examples.sui.io/patterns/witness.html">Sui Move by Example</a> by <a href="https://github.com/damirka">Damir Shamanaev</a>.</em></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="accountless-design"><a class="header" href="#accountless-design">Accountless Design</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Accountless Design</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/villesundell">Ville Sundell</a></td></tr>
<tr><td><strong>Example</strong></td><td><a href="https://web.archive.org/web/20220202065315/https://community.diem.com/t/outbox-an-alternative-way-to-store-resources/3737">Diem Forum Post</a></td></tr>
<tr><td><strong>Depends on</strong></td><td>None</td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary-4"><a class="header" href="#summary-4">Summary</a></h2>
<p>Move module following the <strong>Accountless Design</strong> pattern doesn't handle storage (<code>move_to()</code> / <code>move_from()</code>) directly, instead the storage must be handled outside the module in transaction scripts. This makes the module code footprint smaller, design simpler, implementation more portable and provides a way to implement storage agnostic smart contract design on some Move powered platforms.</p>
<h2 id="examples-4"><a class="header" href="#examples-4">Examples</a></h2>
<pre><code class="language-move">module 0x1::Outbox {
    use Std::Event;
    use Std::Signer;
    use Std::Vector;

    struct Item&lt;Content: key + store&gt; has key, store {
        from: address,
        to: address,
        content: Content
    }

    struct Outbox&lt;Content: key + store&gt; has key, store {
        content: vector&lt;Item&lt;Content&gt;&gt;
    }

    struct Put&lt;phantom Content&gt; has key, drop, store {
    }

    struct EventHandle&lt;phantom Content: drop + store&gt; has key, store {
        event_handle: Event::EventHandle&lt;Content&gt;
    }

    public fun create&lt;Content: key + store&gt;(account: &amp;signer) {
        move_to&lt;Outbox&lt;Content&gt;&gt;(account, Outbox&lt;Content&gt; { content: Vector::empty&lt;Item&lt;Content&gt;&gt;() });
        move_to&lt;EventHandle&lt;Put&lt;Content&gt;&gt;&gt;(account, EventHandle&lt;Put&lt;Content&gt;&gt; { event_handle: Event::new_event_handle&lt;Put&lt;Content&gt;&gt;(account) } );
    }

    public fun put&lt;Content: key + store&gt;(account: &amp;signer, from: address, to: address, content: Content) acquires EventHandle, Outbox {
        let outbox_owner = Signer::address_of(account);
        let event_handle = borrow_global_mut&lt;EventHandle&lt;Put&lt;Content&gt;&gt;&gt;(outbox_owner);
        let outbox = borrow_global_mut&lt;Outbox&lt;Content&gt;&gt;(outbox_owner);

        assert!(to != @0x0, 123);

        Vector::push_back&lt;Item&lt;Content&gt;&gt;(&amp;mut outbox.content, Item&lt;Content&gt;{ from, to, content });
        Event::emit_event&lt;Put&lt;Content&gt;&gt;(&amp;mut event_handle.event_handle, Put&lt;Content&gt; {});
    }

    public fun get&lt;Content: key + store&gt;(account: &amp;signer, outbox_owner: address, index: u64): Content acquires Outbox {
        let account_addr = Signer::address_of(account);
        let outbox = borrow_global_mut&lt;Outbox&lt;Content&gt;&gt;(outbox_owner);

        let Item&lt;Content&gt;{from, to, content} = Vector::swap_remove&lt;Item&lt;Content&gt;&gt;(&amp;mut outbox.content, index);

        assert!(from == account_addr || to == account_addr, 123);

        content
    }
}
</code></pre>
<p><em>Now <code>Outbox</code> can be used to retrieve and store resources in transaction scripts, and pass those to modules following the <a href="./script_based_design.html">Script Based Design</a> pattern.</em></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hot-potato"><a class="header" href="#hot-potato">Hot Potato</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Hot Potato</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/MystenLabs/sui/blob/20e68787b3ace2b408ba0c1d8d9117fc5206cb05/sui_programmability/examples/defi/sources/FlashLender.move#L19">Sui Project</a> / <a href="https://github.com/tnowacki">Todd Nowacki</a></td></tr>
<tr><td><strong>Example</strong></td><td><a href="https://github.com/MystenLabs/sui/blob/a6156aeaf332b9f257cf04063a9a751a7a431360/sui_programmability/examples/defi/sources/flash_lender.move">FlashLender.move</a></td></tr>
<tr><td><strong>Depends on</strong></td><td>None</td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary-5"><a class="header" href="#summary-5">Summary</a></h2>
<p>A <strong>Hot Potato</strong> is a struct without <code>key</code>, <code>store</code> and <code>drop</code> <a href="https://move-language.github.io/move/abilities.html">abilities</a> forcing the struct to be used within the transaction it was created in. This is desired in applications like <a href="https://github.com/MystenLabs/sui/blob/a6156aeaf332b9f257cf04063a9a751a7a431360/sui_programmability/examples/defi/sources/flash_lender.move">flash loans</a> where the loans must be initiated and repaid during the same transaction.</p>
<h2 id="examples-5"><a class="header" href="#examples-5">Examples</a></h2>
<pre><code class="language-move">// Copyright (c) 2022, Mysten Labs, Inc.
// SPDX-License-Identifier: Apache-2.0

/// A flash loan that works for any Coin type
module defi::flash_lender {
    use sui::balance::{Self, Balance};
    use sui::coin::{Self, Coin};
    use sui::object::{Self, ID, UID};
    use sui::transfer;
    use sui::tx_context::{Self, TxContext};

    /// A shared object offering flash loans to any buyer willing to pay `fee`.
    struct FlashLender&lt;phantom T&gt; has key {
        id: UID,
        /// Coins available to be lent to prospective borrowers
        to_lend: Balance&lt;T&gt;,
        /// Number of `Coin&lt;T&gt;`'s that will be charged for the loan.
        /// In practice, this would probably be a percentage, but
        /// we use a flat fee here for simplicity.
        fee: u64,
    }

    /// A &quot;hot potato&quot; struct recording the number of `Coin&lt;T&gt;`'s that
    /// were borrowed. Because this struct does not have the `key` or
    /// `store` ability, it cannot be transferred or otherwise placed in
    /// persistent storage. Because it does not have the `drop` ability,
    /// it cannot be discarded. Thus, the only way to get rid of this
    /// struct is to call `repay` sometime during the transaction that created it,
    /// which is exactly what we want from a flash loan.
    struct Receipt&lt;phantom T&gt; {
        /// ID of the flash lender object the debt holder borrowed from
        flash_lender_id: ID,
        /// Total amount of funds the borrower must repay: amount borrowed + the fee
        repay_amount: u64
    }

    /// An object conveying the privilege to withdraw funds from and deposit funds to the
    /// `FlashLender` instance with ID `flash_lender_id`. Initially granted to the creator
    /// of the `FlashLender`, and only one `AdminCap` per lender exists.
    struct AdminCap has key, store {
        id: UID,
        flash_lender_id: ID,
    }

    /// Attempted to borrow more than the `FlashLender` has.
    /// Try borrowing a smaller amount.
    const ELoanTooLarge: u64 = 0;

    /// Tried to repay an amount other than `repay_amount` (i.e., the amount borrowed + the fee).
    /// Try repaying the proper amount.
    const EInvalidRepaymentAmount: u64 = 1;

    /// Attempted to repay a `FlashLender` that was not the source of this particular debt.
    /// Try repaying the correct lender.
    const ERepayToWrongLender: u64 = 2;

    /// Attempted to perform an admin-only operation without valid permissions
    /// Try using the correct `AdminCap`
    const EAdminOnly: u64 = 3;

    /// Attempted to withdraw more than the `FlashLender` has.
    /// Try withdrawing a smaller amount.
    const EWithdrawTooLarge: u64 = 4;

    // === Creating a flash lender ===

    /// Create a shared `FlashLender` object that makes `to_lend` available for borrowing.
    /// Any borrower will need to repay the borrowed amount and `fee` by the end of the
    /// current transaction.
    public fun new&lt;T&gt;(to_lend: Balance&lt;T&gt;, fee: u64, ctx: &amp;mut TxContext): AdminCap {
        let id = object::new(ctx);
        let flash_lender_id = object::uid_to_inner(&amp;id);
        let flash_lender = FlashLender { id, to_lend, fee };
        // make the `FlashLender` a shared object so anyone can request loans
        transfer::share_object(flash_lender);

        // give the creator admin permissions
        AdminCap { id: object::new(ctx), flash_lender_id }
    }

    /// Same as `new`, but transfer `WithdrawCap` to the transaction sender
    public entry fun create&lt;T&gt;(to_lend: Coin&lt;T&gt;, fee: u64, ctx: &amp;mut TxContext) {
        let balance = coin::into_balance(to_lend);
        let withdraw_cap = new(balance, fee, ctx);

        transfer::transfer(withdraw_cap, tx_context::sender(ctx))
    }

    // === Core functionality: requesting a loan and repaying it ===

    /// Request a loan of `amount` from `lender`. The returned `Receipt&lt;T&gt;` &quot;hot potato&quot; ensures
    /// that the borrower will call `repay(lender, ...)` later on in this tx.
    /// Aborts if `amount` is greater that the amount that `lender` has available for lending.
    public fun loan&lt;T&gt;(
        self: &amp;mut FlashLender&lt;T&gt;, amount: u64, ctx: &amp;mut TxContext
    ): (Coin&lt;T&gt;, Receipt&lt;T&gt;) {
        let to_lend = &amp;mut self.to_lend;
        assert!(balance::value(to_lend) &gt;= amount, ELoanTooLarge);
        let loan = coin::take(to_lend, amount, ctx);
        let repay_amount = amount + self.fee;
        let receipt = Receipt { flash_lender_id: object::id(self), repay_amount };

        (loan, receipt)
    }

    /// Repay the loan recorded by `receipt` to `lender` with `payment`.
    /// Aborts if the repayment amount is incorrect or `lender` is not the `FlashLender`
    /// that issued the original loan.
    public fun repay&lt;T&gt;(self: &amp;mut FlashLender&lt;T&gt;, payment: Coin&lt;T&gt;, receipt: Receipt&lt;T&gt;) {
        let Receipt { flash_lender_id, repay_amount } = receipt;
        assert!(object::id(self) == flash_lender_id, ERepayToWrongLender);
        assert!(coin::value(&amp;payment) == repay_amount, EInvalidRepaymentAmount);

        coin::put(&amp;mut self.to_lend, payment)
    }

    // === Admin-only functionality ===

    /// Allow admin for `self` to withdraw funds.
    public fun withdraw&lt;T&gt;(
        self: &amp;mut FlashLender&lt;T&gt;,
        admin_cap: &amp;AdminCap,
        amount: u64,
        ctx: &amp;mut TxContext
    ): Coin&lt;T&gt; {
        // only the holder of the `AdminCap` for `self` can withdraw funds
        check_admin(self, admin_cap);

        let to_lend = &amp;mut self.to_lend;
        assert!(balance::value(to_lend) &gt;= amount, EWithdrawTooLarge);
        coin::take(to_lend, amount, ctx)
    }

    /// Allow admin to add more funds to `self`
    public entry fun deposit&lt;T&gt;(
        self: &amp;mut FlashLender&lt;T&gt;, admin_cap: &amp;AdminCap, coin: Coin&lt;T&gt;
    ) {
        // only the holder of the `AdminCap` for `self` can deposit funds
        check_admin(self, admin_cap);
        coin::put(&amp;mut self.to_lend, coin);
    }

    /// Allow admin to update the fee for `self`
    public entry fun update_fee&lt;T&gt;(
        self: &amp;mut FlashLender&lt;T&gt;, admin_cap: &amp;AdminCap, new_fee: u64
    ) {
        // only the holder of the `AdminCap` for `self` can update the fee
        check_admin(self, admin_cap);

        self.fee = new_fee
    }

    fun check_admin&lt;T&gt;(self: &amp;FlashLender&lt;T&gt;, admin_cap: &amp;AdminCap) {
        assert!(object::borrow_id(self) == &amp;admin_cap.flash_lender_id, EAdminOnly);
    }

    // === Reads ===

    /// Return the current fee for `self`
    public fun fee&lt;T&gt;(self: &amp;FlashLender&lt;T&gt;): u64 {
        self.fee
    }

    /// Return the maximum amount available for borrowing
    public fun max_loan&lt;T&gt;(self: &amp;FlashLender&lt;T&gt;): u64 {
        balance::value(&amp;self.to_lend)
    }

    /// Return the amount that the holder of `self` must repay
    public fun repay_amount&lt;T&gt;(self: &amp;Receipt&lt;T&gt;): u64 {
        self.repay_amount
    }

    /// Return the amount that the holder of `self` must repay
    public fun flash_lender_id&lt;T&gt;(self: &amp;Receipt&lt;T&gt;): ID {
        self.flash_lender_id
    }
}
</code></pre>
<p><em>Example for Sui Move is taken from the <a href="https://github.com/MystenLabs/sui/blob/7af627ea406f0d838b4a26ec9c7ce123ed59fc08/sui_programmability/examples/defi/sources/flash_lender.move">Sui repository</a>.</em></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="script-based-design"><a class="header" href="#script-based-design">Script Based Design</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Script Based Design</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://github.com/villesundell">Ville Sundell</a></td></tr>
<tr><td><strong>Example</strong></td><td>Diem Forum post lost, April 18 2022</td></tr>
<tr><td><strong>Depends on</strong></td><td><a href="./accountless_design.html">Accountless Design</a></td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary-6"><a class="header" href="#summary-6">Summary</a></h2>
<p><strong>Script Based Design</strong> combines <a href="./accountless_design.html">Accountless Design</a> with <em>Move Transaction Scripts</em> enabling a design where most of the business logic resides in transaction scripts, while keeping the most critical parts in modules. This way the transaction scripts can be developed and improved faster than a regular module would, while providing the same kind of guarantees as regular modules by keeping the most critical part (state transitions) in modules.</p>
<h2 id="examples-6"><a class="header" href="#examples-6">Examples</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="transferable-witness"><a class="header" href="#transferable-witness">Transferable Witness</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><strong>Name</strong></td><td>Transferable Witness</td></tr>
<tr><td><strong>Origin</strong></td><td><a href="https://examples.sui.io/patterns/transferable-witness.html">Sui Move by Example</a> / <a href="https://github.com/damirka">Damir Shamanaev</a></td></tr>
<tr><td><strong>Example</strong></td><td><a href="https://examples.sui.io/patterns/transferable-witness.html">Sui Move by Example</a> / <a href="https://github.com/damirka">Damir Shamanaev</a></td></tr>
<tr><td><strong>Depends on</strong></td><td><a href="./capability.html">Capability</a>, <a href="./witness.html">Witness</a></td></tr>
<tr><td><strong>Known to work on</strong></td><td>Move</td></tr>
</tbody></table>
<h2 id="summary-7"><a class="header" href="#summary-7">Summary</a></h2>
<p>A <strong>Transferable Witness</strong> is a semi-ephemeral storable <a href="./witness.html">witness</a> wrapped into a disposable <a href="./capability.html">capability</a>. </p>
<h2 id="examples-7"><a class="header" href="#examples-7">Examples</a></h2>
<pre><code class="language-move">/// This pattern is based on combination of two others: Capability and a Witness.
/// Since Witness is something to be careful with, spawning it should be only
/// allowed to authorized users (ideally only once). But some scenarios require
/// type authorization by module X to be used in another module Y. Or, possibly,
/// there's a case where authorization should be performed after some time.
///
/// For these, rather rare, scerarios a storable witness is a perfect solution.
module examples::transferable_witness {
    use sui::transfer;
    use sui::id::{Self, VersionedID};
    use sui::tx_context::{Self, TxContext};

    /// Witness now has a `store` which allows us to store it inside a wrapper.
    struct WITNESS has store, drop {}

    /// Carries the witness type. Can only be used once to get a Witness.
    struct WitnessCarrier has key { id: VersionedID, witness: WITNESS }

    /// Send a `WitnessCarrier` to the module publisher.
    fun init(ctx: &amp;mut TxContext) {
        transfer::transfer(
            WitnessCarrier { id: tx_context::new_id(ctx), witness: WITNESS {} },
            tx_context::sender(ctx)
        )
    }

    /// Unwrap a carrier and get the inner WITNESS type.
    public fun get_witness(carrier: WitnessCarrier): WITNESS {
        let WitnessCarrier { id, witness } = carrier;
        id::delete(id);
        witness
    }
}
</code></pre>
<p><em>Example for Sui Move is taken from the book <a href="https://examples.sui.io/patterns/transferable-witness.html">Sui Move by Example</a> by <a href="https://github.com/damirka">Damir Shamanaev</a>.</em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
